{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useState } from 'react';\nimport { unstable_batchedUpdates } from 'react-dom';\nexport function createSingletonHandler(factory) {\n  var listeners = [];\n\n  var callback = function (value) {\n    unstable_batchedUpdates(function () {\n      for (var _i = 0, listeners_1 = listeners; _i < listeners_1.length; _i++) {\n        var listener = listeners_1[_i];\n        listener(value);\n      }\n    });\n  };\n\n  var cleanup;\n  return function useSingleton(listener) {\n    useEffect(function () {\n      if (listeners.length === 0) {\n        cleanup = factory(callback);\n      }\n\n      listeners.push(listener);\n      return function () {\n        listeners.splice(listeners.indexOf(listener), 1);\n\n        if (listeners.length === 0) {\n          cleanup();\n          cleanup = undefined;\n        }\n      }; // register handlers only on mount\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n  };\n}\nexport function createSingletonState(_a) {\n  var factory = _a.factory,\n      initialState = _a.initialState;\n  var useSingleton = createSingletonHandler(factory);\n  var value = initialState;\n  return function useSingletonState() {\n    var _a = useState(value),\n        state = _a[0],\n        setState = _a[1];\n\n    useSingleton(function (newValue) {\n      value = newValue;\n      setState(newValue);\n    });\n    return state;\n  };\n}","map":{"version":3,"mappings":"AAAA;AACA;AACA,SAASA,SAAT,EAAoBC,QAApB,QAAoC,OAApC;AACA,SAASC,uBAAT,QAAwC,WAAxC;AAKA,OAAM,SAAUC,sBAAV,CAAoCC,OAApC,EAA2F;EAC/F,IAAMC,SAAS,GAA4B,EAA3C;;EACA,IAAMC,QAAQ,GAAqB,iBAAK;IACtCJ,uBAAuB,CAAC;MACtB,KAAuB,mCAAvB,EAAuBK,uBAAvB,EAAuBA,IAAvB,EAAkC;QAA7B,IAAMC,QAAQ,kBAAd;QACHA,QAAQ,CAACC,KAAD,CAAR;MACD;IACF,CAJsB,CAAvB;EAKD,CAND;;EAOA,IAAIC,OAAJ;EAEA,OAAO,SAASC,YAAT,CAAsBH,QAAtB,EAAgD;IACrDR,SAAS,CAAC;MACR,IAAIK,SAAS,CAACO,MAAV,KAAqB,CAAzB,EAA4B;QAC1BF,OAAO,GAAGN,OAAO,CAACE,QAAD,CAAjB;MACD;;MACDD,SAAS,CAACQ,IAAV,CAAeL,QAAf;MAEA,OAAO;QACLH,SAAS,CAACS,MAAV,CAAiBT,SAAS,CAACU,OAAV,CAAkBP,QAAlB,CAAjB,EAA8C,CAA9C;;QACA,IAAIH,SAAS,CAACO,MAAV,KAAqB,CAAzB,EAA4B;UAC1BF,OAAQ;UACRA,OAAO,GAAGM,SAAV;QACD;MACF,CAND,CANQ,CAaR;MACA;IACD,CAfQ,EAeN,EAfM,CAAT;EAgBD,CAjBD;AAkBD;AAOD,OAAM,SAAUC,oBAAV,CAAkCC,EAAlC,EAAqF;MAAjDd,OAAO;MAAEe,YAAY;EAC7D,IAAMR,YAAY,GAAGR,sBAAsB,CAACC,OAAD,CAA3C;EACA,IAAIK,KAAK,GAAGU,YAAZ;EACA,OAAO,SAASC,iBAAT,GAA0B;IACzB,SAAoBnB,QAAQ,CAAIQ,KAAJ,CAA5B;IAAA,IAACY,KAAK,QAAN;IAAA,IAAQC,QAAQ,QAAhB;;IACNX,YAAY,CAAC,oBAAQ;MACnBF,KAAK,GAAGc,QAAR;MACAD,QAAQ,CAACC,QAAD,CAAR;IACD,CAHW,CAAZ;IAIA,OAAOF,KAAP;EACD,CAPD;AAQD","names":["useEffect","useState","unstable_batchedUpdates","createSingletonHandler","factory","listeners","callback","_i","listener","value","cleanup","useSingleton","length","push","splice","indexOf","undefined","createSingletonState","_a","initialState","useSingletonState","state","setState","newValue"],"sourceRoot":"","sources":["../../../../../src/internal/hooks/use-singleton-handler/index.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useState } from 'react';\nimport { unstable_batchedUpdates } from 'react-dom';\n\ntype ValueCallback<T> = (value: T) => void;\ntype CleanupCallback = () => void;\n\nexport function createSingletonHandler<T>(factory: (handler: ValueCallback<T>) => CleanupCallback) {\n  const listeners: Array<ValueCallback<T>> = [];\n  const callback: ValueCallback<T> = value => {\n    unstable_batchedUpdates(() => {\n      for (const listener of listeners) {\n        listener(value);\n      }\n    });\n  };\n  let cleanup: (() => void) | undefined;\n\n  return function useSingleton(listener: ValueCallback<T>) {\n    useEffect(() => {\n      if (listeners.length === 0) {\n        cleanup = factory(callback);\n      }\n      listeners.push(listener);\n\n      return () => {\n        listeners.splice(listeners.indexOf(listener), 1);\n        if (listeners.length === 0) {\n          cleanup!();\n          cleanup = undefined;\n        }\n      };\n      // register handlers only on mount\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n  };\n}\n\ninterface SingletonStateOptions<T> {\n  factory: (handler: ValueCallback<T>) => CleanupCallback;\n  initialState: T | (() => T); // useState signature\n}\n\nexport function createSingletonState<T>({ factory, initialState }: SingletonStateOptions<T>) {\n  const useSingleton = createSingletonHandler(factory);\n  let value = initialState;\n  return function useSingletonState() {\n    const [state, setState] = useState<T>(value);\n    useSingleton(newValue => {\n      value = newValue;\n      setState(newValue);\n    });\n    return state;\n  };\n}\n"]},"metadata":{},"sourceType":"module"}
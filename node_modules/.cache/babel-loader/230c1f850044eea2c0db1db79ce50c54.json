{"ast":null,"code":"import { __assign, __spreadArray } from \"tslib\"; // Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React, { useReducer, useRef } from 'react';\nimport InternalBreadcrumbGroup from '../../breadcrumb-group/internal';\nimport { InternalButton } from '../../button/internal';\nimport InternalModal from '../../modal/internal';\nimport InternalSpaceBetween from '../../space-between/internal';\nimport { useEffectOnUpdate } from '../../internal/hooks/use-effect-on-update';\nimport { useVisualRefresh } from '../../internal/hooks/use-visual-mode';\nimport { BucketsTable } from './buckets-table';\nimport { ObjectsTable } from './objects-table';\nimport { VersionsTable } from './versions-table';\nimport styles from './styles.css.js';\nimport { joinObjectPath } from '../utils'; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\nfunction assertNever(_value) {\n  return null;\n}\n\nvar initialBrowseState = {\n  selectedItem: null,\n  currentView: 'buckets',\n  breadcrumbs: []\n};\n\nfunction s3BrowseReducer(state, action) {\n  switch (action.type) {\n    case 'browse-buckets':\n      return initialBrowseState;\n\n    case 'browse-objects':\n      return {\n        selectedItem: null,\n        currentView: 'objects',\n        breadcrumbs: action.breadcrumbs\n      };\n\n    case 'browse-versions':\n      return {\n        selectedItem: null,\n        currentView: 'versions',\n        breadcrumbs: action.breadcrumbs\n      };\n\n    case 'select-item':\n      return __assign(__assign({}, state), {\n        selectedItem: action.item\n      });\n\n    default:\n      assertNever(action);\n  }\n\n  return state;\n}\n\nfunction createResourceInfo(_a) {\n  var currentView = _a.currentView,\n      breadcrumbs = _a.breadcrumbs,\n      selectedItem = _a.selectedItem;\n  var prefix = 's3://';\n\n  if (currentView === 'versions') {\n    return {\n      uri: prefix + joinObjectPath(breadcrumbs),\n      versionId: selectedItem !== null && selectedItem !== void 0 ? selectedItem : undefined\n    };\n  }\n\n  return {\n    uri: prefix + joinObjectPath(__spreadArray(__spreadArray([], breadcrumbs, true), [selectedItem], false))\n  };\n}\n\nexport function S3Modal(_a) {\n  var _b, _c;\n\n  var i18nStrings = _a.i18nStrings,\n      alert = _a.alert,\n      selectableItemsTypes = _a.selectableItemsTypes,\n      fetchBuckets = _a.fetchBuckets,\n      bucketsVisibleColumns = _a.bucketsVisibleColumns,\n      bucketsIsItemDisabled = _a.bucketsIsItemDisabled,\n      fetchObjects = _a.fetchObjects,\n      objectsVisibleColumns = _a.objectsVisibleColumns,\n      objectsIsItemDisabled = _a.objectsIsItemDisabled,\n      fetchVersions = _a.fetchVersions,\n      versionsVisibleColumns = _a.versionsVisibleColumns,\n      versionsIsItemDisabled = _a.versionsIsItemDisabled,\n      onSubmit = _a.onSubmit,\n      onDismiss = _a.onDismiss;\n\n  var _d = useReducer(s3BrowseReducer, initialBrowseState),\n      _e = _d[0],\n      currentView = _e.currentView,\n      breadcrumbs = _e.breadcrumbs,\n      selectedItem = _e.selectedItem,\n      dispatch = _d[1];\n\n  var forwardFocusRef = useRef(null);\n  var modalWrapperRef = useRef(null);\n  var isVisualRefresh = useVisualRefresh(modalWrapperRef);\n  useEffectOnUpdate(function () {\n    var _a;\n\n    (_a = forwardFocusRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n  }, [breadcrumbs]);\n  return React.createElement(\"div\", {\n    ref: modalWrapperRef\n  }, React.createElement(InternalModal, {\n    visible: true,\n    size: \"max\",\n    closeAriaLabel: (_b = i18nStrings === null || i18nStrings === void 0 ? void 0 : i18nStrings.labelModalDismiss) !== null && _b !== void 0 ? _b : '',\n    onDismiss: onDismiss,\n    header: i18nStrings === null || i18nStrings === void 0 ? void 0 : i18nStrings.modalTitle,\n    footer: React.createElement(InternalSpaceBetween, {\n      className: styles['modal-actions'],\n      size: \"xs\",\n      direction: \"horizontal\"\n    }, React.createElement(InternalButton, {\n      variant: \"link\",\n      formAction: \"none\",\n      onClick: onDismiss\n    }, i18nStrings === null || i18nStrings === void 0 ? void 0 : i18nStrings.modalCancelButton), React.createElement(InternalButton, {\n      variant: \"primary\",\n      className: styles['submit-button'],\n      disabled: !selectedItem,\n      formAction: \"none\",\n      onClick: function () {\n        return onSubmit(createResourceInfo({\n          currentView: currentView,\n          breadcrumbs: breadcrumbs,\n          selectedItem: selectedItem\n        }));\n      }\n    }, i18nStrings === null || i18nStrings === void 0 ? void 0 : i18nStrings.modalSubmitButton))\n  }, React.createElement(InternalSpaceBetween, {\n    size: isVisualRefresh ? 'xxs' : 'xs'\n  }, React.createElement(InternalBreadcrumbGroup, {\n    ariaLabel: i18nStrings === null || i18nStrings === void 0 ? void 0 : i18nStrings.labelBreadcrumbs,\n    expandAriaLabel: \"Show path\",\n    onFollow: function (event) {\n      event.preventDefault();\n      event.detail.item.meta.onClick();\n    },\n    items: __spreadArray([{\n      text: (_c = i18nStrings === null || i18nStrings === void 0 ? void 0 : i18nStrings.modalBreadcrumbRootItem) !== null && _c !== void 0 ? _c : '',\n      href: '',\n      meta: {\n        onClick: function () {\n          return dispatch({\n            type: 'browse-buckets'\n          });\n        }\n      }\n    }], breadcrumbs.map(function (segment, index) {\n      return {\n        text: segment,\n        href: '',\n        meta: {\n          onClick: function () {\n            return dispatch({\n              type: 'browse-objects',\n              breadcrumbs: breadcrumbs.slice(0, index + 1)\n            });\n          }\n        }\n      };\n    }), true)\n  }), alert, currentView === 'buckets' ? React.createElement(BucketsTable, {\n    forwardFocusRef: forwardFocusRef,\n    fetchData: fetchBuckets,\n    visibleColumns: bucketsVisibleColumns,\n    isItemDisabled: bucketsIsItemDisabled,\n    selectableItemsTypes: selectableItemsTypes,\n    i18nStrings: i18nStrings,\n    isVisualRefresh: isVisualRefresh,\n    onDrilldown: function (path) {\n      return dispatch({\n        type: 'browse-objects',\n        breadcrumbs: [path]\n      });\n    },\n    onSelect: function (item) {\n      return dispatch({\n        type: 'select-item',\n        item: item\n      });\n    }\n  }) : currentView === 'objects' ? React.createElement(ObjectsTable, {\n    forwardFocusRef: forwardFocusRef,\n    pathSegments: breadcrumbs,\n    fetchData: fetchObjects,\n    visibleColumns: objectsVisibleColumns,\n    isItemDisabled: objectsIsItemDisabled,\n    selectableItemsTypes: selectableItemsTypes,\n    i18nStrings: i18nStrings,\n    isVisualRefresh: isVisualRefresh,\n    onDrilldown: function (item) {\n      dispatch({\n        type: item.IsFolder ? 'browse-objects' : 'browse-versions',\n        breadcrumbs: __spreadArray(__spreadArray([], breadcrumbs, true), [item.Key], false)\n      });\n    },\n    onSelect: function (item) {\n      return dispatch({\n        type: 'select-item',\n        item: item\n      });\n    }\n  }) : currentView === 'versions' ? React.createElement(VersionsTable, {\n    forwardFocusRef: forwardFocusRef,\n    pathSegments: breadcrumbs,\n    fetchData: fetchVersions,\n    visibleColumns: versionsVisibleColumns,\n    isItemDisabled: versionsIsItemDisabled,\n    i18nStrings: i18nStrings,\n    isVisualRefresh: isVisualRefresh,\n    onSelect: function (item) {\n      return dispatch({\n        type: 'select-item',\n        item: item\n      });\n    }\n  }) : assertNever(currentView))));\n}","map":{"version":3,"mappings":"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","names":["React","useReducer","useRef","InternalBreadcrumbGroup","InternalButton","InternalModal","InternalSpaceBetween","useEffectOnUpdate","useVisualRefresh","BucketsTable","ObjectsTable","VersionsTable","styles","joinObjectPath","assertNever","_value","initialBrowseState","selectedItem","currentView","breadcrumbs","s3BrowseReducer","state","action","type","item","createResourceInfo","_a","prefix","uri","versionId","undefined","S3Modal","i18nStrings","alert","selectableItemsTypes","fetchBuckets","bucketsVisibleColumns","bucketsIsItemDisabled","fetchObjects","objectsVisibleColumns","objectsIsItemDisabled","fetchVersions","versionsVisibleColumns","versionsIsItemDisabled","onSubmit","onDismiss","_e","dispatch","forwardFocusRef","modalWrapperRef","isVisualRefresh","current","focus","ref","visible","size","closeAriaLabel","labelModalDismiss","_b","header","modalTitle","footer","className","direction","variant","formAction","onClick","modalCancelButton","disabled","modalSubmitButton","ariaLabel","labelBreadcrumbs","expandAriaLabel","onFollow","event","preventDefault","detail","meta","items","text","modalBreadcrumbRootItem","_c","href","map","segment","index","slice","fetchData","visibleColumns","isItemDisabled","onDrilldown","path","onSelect","pathSegments","IsFolder","Key"],"sourceRoot":"","sources":["../../../../src/s3-resource-selector/s3-modal/index.tsx"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useReducer, useRef } from 'react';\nimport InternalBreadcrumbGroup from '../../breadcrumb-group/internal';\nimport { InternalButton } from '../../button/internal';\nimport InternalModal from '../../modal/internal';\nimport InternalSpaceBetween from '../../space-between/internal';\nimport { ForwardFocusRef } from '../../internal/hooks/forward-focus';\nimport { useEffectOnUpdate } from '../../internal/hooks/use-effect-on-update';\nimport { useVisualRefresh } from '../../internal/hooks/use-visual-mode';\nimport { S3ResourceSelectorProps } from '../interfaces';\nimport { BucketsTable } from './buckets-table';\nimport { ObjectsTable } from './objects-table';\nimport { VersionsTable } from './versions-table';\nimport styles from './styles.css.js';\nimport { joinObjectPath } from '../utils';\n\nexport interface S3ModalProps {\n  alert: React.ReactNode;\n  selectableItemsTypes: S3ResourceSelectorProps['selectableItemsTypes'];\n  fetchBuckets: S3ResourceSelectorProps['fetchBuckets'];\n  bucketsVisibleColumns: ReadonlyArray<string>;\n  bucketsIsItemDisabled: S3ResourceSelectorProps['bucketsIsItemDisabled'];\n  fetchObjects: S3ResourceSelectorProps['fetchObjects'];\n  objectsVisibleColumns: ReadonlyArray<string>;\n  objectsIsItemDisabled: S3ResourceSelectorProps['objectsIsItemDisabled'];\n  fetchVersions: S3ResourceSelectorProps['fetchVersions'];\n  versionsVisibleColumns: ReadonlyArray<string>;\n  versionsIsItemDisabled: S3ResourceSelectorProps['versionsIsItemDisabled'];\n  i18nStrings: S3ResourceSelectorProps.I18nStrings | undefined;\n  onDismiss: () => void;\n  onSubmit: (resource: S3ResourceSelectorProps.Resource) => void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction assertNever(_value: never) {\n  return null;\n}\n\ninterface S3BrowseState {\n  selectedItem: string | null;\n  currentView: 'buckets' | 'objects' | 'versions';\n  breadcrumbs: ReadonlyArray<string>;\n}\n\ntype S3BrowseActions =\n  | { type: 'browse-buckets' }\n  | { type: 'browse-objects' | 'browse-versions'; breadcrumbs: S3BrowseState['breadcrumbs'] }\n  | { type: 'select-item'; item: string };\n\nconst initialBrowseState: S3BrowseState = {\n  selectedItem: null,\n  currentView: 'buckets',\n  breadcrumbs: [],\n};\n\nfunction s3BrowseReducer(state: S3BrowseState, action: S3BrowseActions) {\n  switch (action.type) {\n    case 'browse-buckets':\n      return initialBrowseState;\n    case 'browse-objects':\n      return {\n        selectedItem: null,\n        currentView: 'objects' as const,\n        breadcrumbs: action.breadcrumbs,\n      };\n    case 'browse-versions':\n      return {\n        selectedItem: null,\n        currentView: 'versions' as const,\n        breadcrumbs: action.breadcrumbs,\n      };\n    case 'select-item':\n      return {\n        ...state,\n        selectedItem: action.item,\n      };\n    default:\n      assertNever(action);\n  }\n  return state;\n}\n\nfunction createResourceInfo({ currentView, breadcrumbs, selectedItem }: S3BrowseState) {\n  const prefix = 's3://';\n  if (currentView === 'versions') {\n    return { uri: prefix + joinObjectPath(breadcrumbs), versionId: selectedItem ?? undefined };\n  }\n  return { uri: prefix + joinObjectPath([...breadcrumbs, selectedItem!]) };\n}\n\nexport function S3Modal({\n  i18nStrings,\n  alert,\n  selectableItemsTypes,\n  fetchBuckets,\n  bucketsVisibleColumns,\n  bucketsIsItemDisabled,\n  fetchObjects,\n  objectsVisibleColumns,\n  objectsIsItemDisabled,\n  fetchVersions,\n  versionsVisibleColumns,\n  versionsIsItemDisabled,\n  onSubmit,\n  onDismiss,\n}: S3ModalProps) {\n  const [{ currentView, breadcrumbs, selectedItem }, dispatch] = useReducer(s3BrowseReducer, initialBrowseState);\n  const forwardFocusRef = useRef<ForwardFocusRef>(null);\n\n  const modalWrapperRef = useRef(null);\n  const isVisualRefresh = useVisualRefresh(modalWrapperRef);\n\n  useEffectOnUpdate(() => {\n    forwardFocusRef.current?.focus();\n  }, [breadcrumbs]);\n\n  return (\n    <div ref={modalWrapperRef}>\n      <InternalModal\n        visible={true}\n        size=\"max\"\n        closeAriaLabel={i18nStrings?.labelModalDismiss ?? ''}\n        onDismiss={onDismiss}\n        header={i18nStrings?.modalTitle}\n        footer={\n          <InternalSpaceBetween className={styles['modal-actions']} size=\"xs\" direction=\"horizontal\">\n            <InternalButton variant=\"link\" formAction=\"none\" onClick={onDismiss}>\n              {i18nStrings?.modalCancelButton}\n            </InternalButton>\n            <InternalButton\n              variant=\"primary\"\n              className={styles['submit-button']}\n              disabled={!selectedItem}\n              formAction=\"none\"\n              onClick={() => onSubmit(createResourceInfo({ currentView, breadcrumbs, selectedItem }))}\n            >\n              {i18nStrings?.modalSubmitButton}\n            </InternalButton>\n          </InternalSpaceBetween>\n        }\n      >\n        <InternalSpaceBetween size={isVisualRefresh ? 'xxs' : 'xs'}>\n          <InternalBreadcrumbGroup\n            ariaLabel={i18nStrings?.labelBreadcrumbs}\n            expandAriaLabel=\"Show path\"\n            onFollow={event => {\n              event.preventDefault();\n              event.detail.item.meta.onClick();\n            }}\n            items={[\n              {\n                text: i18nStrings?.modalBreadcrumbRootItem ?? '',\n                href: '',\n                meta: { onClick: () => dispatch({ type: 'browse-buckets' }) },\n              },\n              ...breadcrumbs.map((segment, index) => ({\n                text: segment,\n                href: '',\n                meta: {\n                  onClick: () =>\n                    dispatch({\n                      type: 'browse-objects',\n                      breadcrumbs: breadcrumbs.slice(0, index + 1),\n                    }),\n                },\n              })),\n            ]}\n          />\n          {alert}\n          {currentView === 'buckets' ? (\n            <BucketsTable\n              forwardFocusRef={forwardFocusRef}\n              fetchData={fetchBuckets}\n              visibleColumns={bucketsVisibleColumns}\n              isItemDisabled={bucketsIsItemDisabled}\n              selectableItemsTypes={selectableItemsTypes}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onDrilldown={path =>\n                dispatch({\n                  type: 'browse-objects',\n                  breadcrumbs: [path],\n                })\n              }\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : currentView === 'objects' ? (\n            <ObjectsTable\n              forwardFocusRef={forwardFocusRef}\n              pathSegments={breadcrumbs}\n              fetchData={fetchObjects}\n              visibleColumns={objectsVisibleColumns}\n              isItemDisabled={objectsIsItemDisabled}\n              selectableItemsTypes={selectableItemsTypes}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onDrilldown={item => {\n                dispatch({\n                  type: item.IsFolder ? 'browse-objects' : 'browse-versions',\n                  breadcrumbs: [...breadcrumbs, item.Key!],\n                });\n              }}\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : currentView === 'versions' ? (\n            <VersionsTable\n              forwardFocusRef={forwardFocusRef}\n              pathSegments={breadcrumbs}\n              fetchData={fetchVersions}\n              visibleColumns={versionsVisibleColumns}\n              isItemDisabled={versionsIsItemDisabled}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : (\n            assertNever(currentView)\n          )}\n        </InternalSpaceBetween>\n      </InternalModal>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}
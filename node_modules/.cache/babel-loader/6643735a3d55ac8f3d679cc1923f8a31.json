{"ast":null,"code":"import { __assign, __rest } from \"tslib\"; // Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport clsx from 'clsx';\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useAutosuggestItems, useFilteredItems, useKeyboardHandler } from './controller';\nimport Dropdown from '../internal/components/dropdown';\nimport { useDropdownStatus } from '../internal/components/dropdown-status';\nimport DropdownFooter from '../internal/components/dropdown-footer';\nimport { useFormFieldContext } from '../internal/context/form-field-context';\nimport { getBaseProps } from '../internal/base-component';\nimport { generateUniqueId, useUniqueId } from '../internal/hooks/use-unique-id';\nimport useForwardFocus from '../internal/hooks/forward-focus';\nimport { fireNonCancelableEvent } from '../internal/events';\nimport { createHighlightedOptionHook } from '../internal/components/options-list/utils/use-highlight-option';\nimport InternalInput from '../input/internal';\nimport styles from './styles.css.js';\nimport { checkOptionValueField } from '../select/utils/check-option-value-field';\nimport checkControlled from '../internal/hooks/check-controlled';\nimport { fireCancelableEvent } from '../internal/events/index';\nimport AutosuggestOptionsList from './options-list';\n\nvar isInteractive = function (option) {\n  return !!option && !option.disabled && option.type !== 'parent';\n};\n\nvar isHighlightable = function (option) {\n  return !!option && option.type !== 'parent';\n};\n\nvar useHighlightedOption = createHighlightedOptionHook({\n  isHighlightable: isHighlightable\n});\n\nvar useLoadMoreItems = function (onLoadItems) {\n  var lastFilteringText = useRef(null);\n  return useCallback(function (firstPage, samePage, filteringText) {\n    if (samePage || !firstPage || filteringText === undefined || lastFilteringText.current !== filteringText) {\n      if (filteringText !== undefined) {\n        lastFilteringText.current = filteringText;\n      }\n\n      if (lastFilteringText.current !== null && onLoadItems) {\n        fireNonCancelableEvent(onLoadItems, {\n          filteringText: lastFilteringText.current,\n          firstPage: firstPage,\n          samePage: samePage\n        });\n      }\n    }\n  }, [onLoadItems]);\n};\n\nvar InternalAutosuggest = React.forwardRef(function (props, ref) {\n  var _a;\n\n  var value = props.value,\n      onChange = props.onChange,\n      onBlur = props.onBlur,\n      onFocus = props.onFocus,\n      onKeyUp = props.onKeyUp,\n      onLoadItems = props.onLoadItems,\n      options = props.options,\n      _b = props.filteringType,\n      filteringType = _b === void 0 ? 'auto' : _b,\n      _c = props.statusType,\n      statusType = _c === void 0 ? 'finished' : _c,\n      placeholder = props.placeholder,\n      name = props.name,\n      disabled = props.disabled,\n      _d = props.disableBrowserAutocorrect,\n      disableBrowserAutocorrect = _d === void 0 ? false : _d,\n      autoFocus = props.autoFocus,\n      readOnly = props.readOnly,\n      ariaLabel = props.ariaLabel,\n      ariaRequired = props.ariaRequired,\n      enteredTextLabel = props.enteredTextLabel,\n      onKeyDown = props.onKeyDown,\n      virtualScroll = props.virtualScroll,\n      expandToViewport = props.expandToViewport,\n      onSelect = props.onSelect,\n      selectedAriaLabel = props.selectedAriaLabel,\n      renderHighlightedAriaLive = props.renderHighlightedAriaLive,\n      __dropdownWidth = props.__dropdownWidth,\n      __onOptionClick = props.__onOptionClick,\n      __disableShowAll = props.__disableShowAll,\n      __hideEnteredTextOption = props.__hideEnteredTextOption,\n      __onOpen = props.__onOpen,\n      __internalRootRef = props.__internalRootRef,\n      rest = __rest(props, [\"value\", \"onChange\", \"onBlur\", \"onFocus\", \"onKeyUp\", \"onLoadItems\", \"options\", \"filteringType\", \"statusType\", \"placeholder\", \"name\", \"disabled\", \"disableBrowserAutocorrect\", \"autoFocus\", \"readOnly\", \"ariaLabel\", \"ariaRequired\", \"enteredTextLabel\", \"onKeyDown\", \"virtualScroll\", \"expandToViewport\", \"onSelect\", \"selectedAriaLabel\", \"renderHighlightedAriaLive\", \"__dropdownWidth\", \"__onOptionClick\", \"__disableShowAll\", \"__hideEnteredTextOption\", \"__onOpen\", \"__internalRootRef\"]);\n\n  var filterText = rest.__filterText;\n  filterText = filterText === undefined ? value : filterText;\n  checkControlled('Autosuggest', 'value', value, 'onChange', onChange);\n  checkOptionValueField('Autosuggest', 'options', options);\n  var usingMouse = useRef(true);\n\n  var _e = useState(false),\n      showAll = _e[0],\n      setShowAll = _e[1];\n\n  var _f = useState(false),\n      open = _f[0],\n      setOpen = _f[1];\n\n  var autosuggestItems = useAutosuggestItems(options);\n  var filteredItems = useFilteredItems(autosuggestItems, value, filterText, filteringType, showAll, __hideEnteredTextOption);\n\n  var openDropdown = function () {\n    return !readOnly && setOpen(true);\n  };\n\n  var scrollToIndex = useRef(null);\n\n  var _g = useHighlightedOption(filteredItems),\n      highlightedOption = _g.highlightedOption,\n      highlightedIndex = _g.highlightedIndex,\n      moveHighlight = _g.moveHighlight,\n      resetHighlight = _g.resetHighlight,\n      setHighlightedIndex = _g.setHighlightedIndex;\n\n  var closeDropdown = function () {\n    setOpen(false);\n    resetHighlight();\n  };\n\n  var handleBlur = function (event) {\n    var _a;\n\n    if (event.currentTarget.contains(event.relatedTarget) || ((_a = dropdownFooterRef.current) === null || _a === void 0 ? void 0 : _a.contains(event.relatedTarget))) {\n      return;\n    }\n\n    closeDropdown();\n    fireNonCancelableEvent(onBlur);\n  };\n\n  var selectOption = function (option) {\n    var value = option.value || '';\n    fireNonCancelableEvent(onChange, {\n      value: value\n    });\n    var selectedCancelled = fireCancelableEvent(__onOptionClick, option);\n\n    if (!selectedCancelled) {\n      closeDropdown();\n    } else {\n      resetHighlight();\n    }\n\n    fireNonCancelableEvent(onSelect, {\n      value: value\n    });\n  };\n\n  var selectHighlighted = function () {\n    if (highlightedOption) {\n      if (isInteractive(highlightedOption)) {\n        selectOption(highlightedOption);\n      }\n    } else {\n      closeDropdown();\n    }\n  };\n\n  var fireLoadMore = useLoadMoreItems(onLoadItems);\n\n  var handleInputChange = function (e) {\n    openDropdown();\n    setShowAll(false);\n    resetHighlight();\n    onChange && onChange(e);\n  };\n\n  var handleKeyDown = useKeyboardHandler(moveHighlight, openDropdown, selectHighlighted, usingMouse, open, onKeyDown);\n  var handleLoadMore = useCallback(function () {\n    options && options.length && statusType === 'pending' && fireLoadMore(false, false);\n  }, [fireLoadMore, options, statusType]);\n  var handleRecoveryClick = useCallback(function () {\n    var _a;\n\n    fireLoadMore(false, true);\n    (_a = inputRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n  }, [fireLoadMore]);\n  var formFieldContext = useFormFieldContext(rest);\n  var baseProps = getBaseProps(rest);\n  var inputRef = useRef(null);\n  var dropdownFooterRef = useRef(null);\n  useForwardFocus(ref, inputRef);\n  var selfControlId = useUniqueId('input');\n  var controlId = (_a = formFieldContext.controlId) !== null && _a !== void 0 ? _a : selfControlId;\n  var dropdownId = useUniqueId('dropdown');\n  var listId = useUniqueId('list'); // From an a11y point of view we only count the dropdown as 'expanded' if there are items that a user can dropdown into\n\n  var expanded = open && filteredItems.length > 1;\n  var highlightedOptionId = highlightedOption ? generateUniqueId() : undefined;\n  var nativeAttributes = {\n    name: name,\n    placeholder: placeholder,\n    autoFocus: autoFocus,\n    onClick: openDropdown,\n    role: 'combobox',\n    'aria-autocomplete': 'list',\n    'aria-expanded': expanded,\n    'aria-controls': listId,\n    // 'aria-owns' needed for safari+vo to announce activedescendant content\n    'aria-owns': listId,\n    'aria-label': ariaLabel,\n    'aria-activedescendant': highlightedOptionId\n  };\n\n  var handleInputFocus = function (e) {\n    !__disableShowAll && setShowAll(true);\n    var openPrevented = fireCancelableEvent(__onOpen, null);\n\n    if (!openPrevented) {\n      openDropdown();\n      fireLoadMore(true, false, '');\n    }\n\n    onFocus === null || onFocus === void 0 ? void 0 : onFocus(e);\n  };\n\n  useEffect(function () {\n    var _a;\n\n    (_a = scrollToIndex.current) === null || _a === void 0 ? void 0 : _a.call(scrollToIndex, highlightedIndex);\n  }, [highlightedIndex]);\n  var isEmpty = !value && !filteredItems.length;\n  var showRecoveryLink = open && statusType === 'error' && props.recoveryText;\n  var dropdownStatus = useDropdownStatus(__assign(__assign({}, props), {\n    isEmpty: isEmpty,\n    onRecoveryClick: handleRecoveryClick\n  }));\n\n  var handleMouseDown = function (event) {\n    // prevent currently focused element from losing it\n    event.preventDefault();\n  };\n\n  return React.createElement(\"div\", __assign({}, baseProps, {\n    className: clsx(styles.root, baseProps.className),\n    ref: __internalRootRef,\n    onBlur: handleBlur\n  }), React.createElement(Dropdown, {\n    minWidth: __dropdownWidth,\n    stretchWidth: !__dropdownWidth,\n    trigger: React.createElement(InternalInput, __assign({\n      type: \"search\",\n      value: value,\n      onChange: handleInputChange,\n      __onDelayedInput: function (event) {\n        return fireLoadMore(true, false, event.detail.value);\n      },\n      onFocus: handleInputFocus,\n      onKeyDown: handleKeyDown,\n      onKeyUp: onKeyUp,\n      disabled: disabled,\n      disableBrowserAutocorrect: disableBrowserAutocorrect,\n      readOnly: readOnly,\n      ariaRequired: ariaRequired,\n      ref: inputRef,\n      autoComplete: false,\n      __nativeAttributes: nativeAttributes\n    }, formFieldContext, {\n      controlId: controlId\n    })),\n    onMouseDown: handleMouseDown,\n    open: open,\n    dropdownId: dropdownId,\n    footer: dropdownStatus.isSticky ? React.createElement(\"div\", {\n      ref: dropdownFooterRef,\n      className: styles['dropdown-footer']\n    }, React.createElement(DropdownFooter, {\n      content: dropdownStatus.content,\n      hasItems: filteredItems.length >= 1\n    })) : null,\n    expandToViewport: expandToViewport,\n    hasContent: filteredItems.length >= 1 || dropdownStatus.content !== null,\n    trapFocus: !!showRecoveryLink\n  }, open && React.createElement(AutosuggestOptionsList, {\n    options: filteredItems,\n    highlightedOption: highlightedOption,\n    selectOption: selectOption,\n    highlightedIndex: highlightedIndex,\n    setHighlightedIndex: setHighlightedIndex,\n    highlightedOptionId: highlightedOptionId,\n    highlightText: filterText,\n    listId: listId,\n    controlId: controlId,\n    enteredTextLabel: enteredTextLabel,\n    handleLoadMore: handleLoadMore,\n    hasDropdownStatus: dropdownStatus.content !== null,\n    virtualScroll: virtualScroll,\n    selectedAriaLabel: selectedAriaLabel,\n    renderHighlightedAriaLive: renderHighlightedAriaLive,\n    listBottom: !dropdownStatus.isSticky ? React.createElement(DropdownFooter, {\n      content: dropdownStatus.content\n    }) : null,\n    usingMouse: usingMouse\n  })));\n});\nexport default InternalAutosuggest;","map":{"version":3,"mappings":"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","names":["clsx","React","useCallback","useEffect","useRef","useState","useAutosuggestItems","useFilteredItems","useKeyboardHandler","Dropdown","useDropdownStatus","DropdownFooter","useFormFieldContext","getBaseProps","generateUniqueId","useUniqueId","useForwardFocus","fireNonCancelableEvent","createHighlightedOptionHook","InternalInput","styles","checkOptionValueField","checkControlled","fireCancelableEvent","AutosuggestOptionsList","isInteractive","option","disabled","type","isHighlightable","useHighlightedOption","useLoadMoreItems","onLoadItems","lastFilteringText","firstPage","samePage","filteringText","undefined","current","InternalAutosuggest","forwardRef","props","ref","onChange","onBlur","onFocus","onKeyUp","options","_b","filteringType","_c","statusType","placeholder","name","_d","disableBrowserAutocorrect","autoFocus","readOnly","ariaLabel","ariaRequired","enteredTextLabel","onKeyDown","virtualScroll","expandToViewport","onSelect","selectedAriaLabel","renderHighlightedAriaLive","__dropdownWidth","__onOptionClick","__disableShowAll","__hideEnteredTextOption","__onOpen","__internalRootRef","rest","filterText","value","usingMouse","showAll","setShowAll","open","setOpen","autosuggestItems","filteredItems","openDropdown","scrollToIndex","highlightedOption","highlightedIndex","moveHighlight","resetHighlight","setHighlightedIndex","closeDropdown","handleBlur","event","currentTarget","contains","relatedTarget","_a","selectOption","selectedCancelled","selectHighlighted","fireLoadMore","handleInputChange","e","handleKeyDown","handleLoadMore","length","handleRecoveryClick","focus","formFieldContext","baseProps","inputRef","dropdownFooterRef","selfControlId","controlId","dropdownId","listId","expanded","highlightedOptionId","nativeAttributes","onClick","role","handleInputFocus","openPrevented","isEmpty","showRecoveryLink","recoveryText","dropdownStatus","onRecoveryClick","handleMouseDown","preventDefault","className","root","minWidth","stretchWidth","trigger","__assign","__onDelayedInput","detail","autoComplete","__nativeAttributes","onMouseDown","footer","isSticky","content","hasItems","hasContent","trapFocus","highlightText","hasDropdownStatus","listBottom"],"sourceRoot":"","sources":["../../../src/autosuggest/internal.tsx"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport clsx from 'clsx';\nimport React, { Ref, useCallback, useEffect, useRef, useState } from 'react';\n\nimport { useAutosuggestItems, useFilteredItems, useKeyboardHandler } from './controller';\nimport { AutosuggestItem, AutosuggestProps } from './interfaces';\n\nimport Dropdown from '../internal/components/dropdown';\nimport { useDropdownStatus } from '../internal/components/dropdown-status';\nimport DropdownFooter from '../internal/components/dropdown-footer';\n\nimport { useFormFieldContext } from '../internal/context/form-field-context';\nimport { getBaseProps } from '../internal/base-component';\nimport { generateUniqueId, useUniqueId } from '../internal/hooks/use-unique-id';\nimport useForwardFocus from '../internal/hooks/forward-focus';\nimport { fireNonCancelableEvent, CancelableEventHandler } from '../internal/events';\nimport { createHighlightedOptionHook } from '../internal/components/options-list/utils/use-highlight-option';\nimport InternalInput from '../input/internal';\nimport { InputProps } from '../input/interfaces';\nimport styles from './styles.css.js';\nimport { checkOptionValueField } from '../select/utils/check-option-value-field';\nimport checkControlled from '../internal/hooks/check-controlled';\nimport { fireCancelableEvent } from '../internal/events/index';\nimport { InternalBaseComponentProps } from '../internal/hooks/use-base-component';\nimport AutosuggestOptionsList from './options-list';\n\nexport interface InternalAutosuggestProps extends AutosuggestProps, InternalBaseComponentProps {\n  __filterText?: string;\n  __dropdownWidth?: number;\n  __onOptionClick?: CancelableEventHandler<AutosuggestProps.Option>;\n  __disableShowAll?: boolean;\n  __hideEnteredTextOption?: boolean;\n  __onOpen?: CancelableEventHandler<null>;\n}\n\nconst isInteractive = (option?: AutosuggestItem) => {\n  return !!option && !option.disabled && option.type !== 'parent';\n};\n\nconst isHighlightable = (option?: AutosuggestItem) => {\n  return !!option && option.type !== 'parent';\n};\n\nconst useHighlightedOption = createHighlightedOptionHook({ isHighlightable: isHighlightable });\n\nconst useLoadMoreItems = (onLoadItems: AutosuggestProps['onLoadItems']) => {\n  const lastFilteringText = useRef<string | null>(null);\n  return useCallback(\n    (firstPage: boolean, samePage: boolean, filteringText?: string) => {\n      if (samePage || !firstPage || filteringText === undefined || lastFilteringText.current !== filteringText) {\n        if (filteringText !== undefined) {\n          lastFilteringText.current = filteringText;\n        }\n        if (lastFilteringText.current !== null && onLoadItems) {\n          fireNonCancelableEvent(onLoadItems, { filteringText: lastFilteringText.current, firstPage, samePage });\n        }\n      }\n    },\n    [onLoadItems]\n  );\n};\n\nconst InternalAutosuggest = React.forwardRef((props: InternalAutosuggestProps, ref: Ref<InputProps.Ref>) => {\n  const {\n    value,\n    onChange,\n    onBlur,\n    onFocus,\n    onKeyUp,\n    onLoadItems,\n    options,\n    filteringType = 'auto',\n    statusType = 'finished',\n    placeholder,\n    name,\n    disabled,\n    disableBrowserAutocorrect = false,\n    autoFocus,\n    readOnly,\n    ariaLabel,\n    ariaRequired,\n    enteredTextLabel,\n    onKeyDown,\n    virtualScroll,\n    expandToViewport,\n    onSelect,\n    selectedAriaLabel,\n    renderHighlightedAriaLive,\n    __dropdownWidth,\n    __onOptionClick,\n    __disableShowAll,\n    __hideEnteredTextOption,\n    __onOpen,\n    __internalRootRef,\n    ...rest\n  } = props;\n  let { __filterText: filterText } = rest;\n  filterText = filterText === undefined ? value : filterText;\n\n  checkControlled('Autosuggest', 'value', value, 'onChange', onChange);\n  checkOptionValueField('Autosuggest', 'options', options);\n\n  const usingMouse = useRef(true);\n  const [showAll, setShowAll] = useState(false);\n  const [open, setOpen] = useState(false);\n  const autosuggestItems = useAutosuggestItems(options);\n  const filteredItems = useFilteredItems(\n    autosuggestItems,\n    value,\n    filterText,\n    filteringType,\n    showAll,\n    __hideEnteredTextOption\n  );\n  const openDropdown = () => !readOnly && setOpen(true);\n  const scrollToIndex = useRef<(index: number) => void>(null);\n  const { highlightedOption, highlightedIndex, moveHighlight, resetHighlight, setHighlightedIndex } =\n    useHighlightedOption(filteredItems);\n  const closeDropdown = () => {\n    setOpen(false);\n    resetHighlight();\n  };\n  const handleBlur: React.FocusEventHandler = event => {\n    if (event.currentTarget.contains(event.relatedTarget) || dropdownFooterRef.current?.contains(event.relatedTarget)) {\n      return;\n    }\n    closeDropdown();\n    fireNonCancelableEvent(onBlur);\n  };\n  const selectOption = (option: AutosuggestItem) => {\n    const value = option.value || '';\n    fireNonCancelableEvent(onChange, { value });\n    const selectedCancelled = fireCancelableEvent(__onOptionClick, option);\n    if (!selectedCancelled) {\n      closeDropdown();\n    } else {\n      resetHighlight();\n    }\n    fireNonCancelableEvent(onSelect, { value });\n  };\n  const selectHighlighted = () => {\n    if (highlightedOption) {\n      if (isInteractive(highlightedOption)) {\n        selectOption(highlightedOption);\n      }\n    } else {\n      closeDropdown();\n    }\n  };\n\n  const fireLoadMore = useLoadMoreItems(onLoadItems);\n\n  const handleInputChange: InputProps['onChange'] = e => {\n    openDropdown();\n    setShowAll(false);\n    resetHighlight();\n    onChange && onChange(e);\n  };\n\n  const handleKeyDown = useKeyboardHandler(moveHighlight, openDropdown, selectHighlighted, usingMouse, open, onKeyDown);\n  const handleLoadMore = useCallback(() => {\n    options && options.length && statusType === 'pending' && fireLoadMore(false, false);\n  }, [fireLoadMore, options, statusType]);\n  const handleRecoveryClick = useCallback(() => {\n    fireLoadMore(false, true);\n    inputRef.current?.focus();\n  }, [fireLoadMore]);\n\n  const formFieldContext = useFormFieldContext(rest);\n  const baseProps = getBaseProps(rest);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const dropdownFooterRef = useRef<HTMLDivElement>(null);\n  useForwardFocus(ref, inputRef);\n\n  const selfControlId = useUniqueId('input');\n  const controlId = formFieldContext.controlId ?? selfControlId;\n  const dropdownId = useUniqueId('dropdown');\n  const listId = useUniqueId('list');\n\n  // From an a11y point of view we only count the dropdown as 'expanded' if there are items that a user can dropdown into\n  const expanded = open && filteredItems.length > 1;\n  const highlightedOptionId = highlightedOption ? generateUniqueId() : undefined;\n  const nativeAttributes = {\n    name,\n    placeholder,\n    autoFocus,\n    onClick: openDropdown,\n    role: 'combobox',\n    'aria-autocomplete': 'list',\n    'aria-expanded': expanded,\n    'aria-controls': listId,\n    // 'aria-owns' needed for safari+vo to announce activedescendant content\n    'aria-owns': listId,\n    'aria-label': ariaLabel,\n    'aria-activedescendant': highlightedOptionId,\n  };\n\n  const handleInputFocus: InputProps['onFocus'] = e => {\n    !__disableShowAll && setShowAll(true);\n    const openPrevented = fireCancelableEvent(__onOpen, null);\n    if (!openPrevented) {\n      openDropdown();\n      fireLoadMore(true, false, '');\n    }\n    onFocus?.(e);\n  };\n\n  useEffect(() => {\n    scrollToIndex.current?.(highlightedIndex);\n  }, [highlightedIndex]);\n\n  const isEmpty = !value && !filteredItems.length;\n  const showRecoveryLink = open && statusType === 'error' && props.recoveryText;\n  const dropdownStatus = useDropdownStatus({ ...props, isEmpty, onRecoveryClick: handleRecoveryClick });\n\n  const handleMouseDown = (event: React.MouseEvent) => {\n    // prevent currently focused element from losing it\n    event.preventDefault();\n  };\n\n  return (\n    <div {...baseProps} className={clsx(styles.root, baseProps.className)} ref={__internalRootRef} onBlur={handleBlur}>\n      <Dropdown\n        minWidth={__dropdownWidth}\n        stretchWidth={!__dropdownWidth}\n        trigger={\n          <InternalInput\n            type=\"search\"\n            value={value}\n            onChange={handleInputChange}\n            __onDelayedInput={event => fireLoadMore(true, false, event.detail.value)}\n            onFocus={handleInputFocus}\n            onKeyDown={handleKeyDown}\n            onKeyUp={onKeyUp}\n            disabled={disabled}\n            disableBrowserAutocorrect={disableBrowserAutocorrect}\n            readOnly={readOnly}\n            ariaRequired={ariaRequired}\n            ref={inputRef}\n            autoComplete={false}\n            __nativeAttributes={nativeAttributes}\n            {...formFieldContext}\n            controlId={controlId}\n          />\n        }\n        onMouseDown={handleMouseDown}\n        open={open}\n        dropdownId={dropdownId}\n        footer={\n          dropdownStatus.isSticky ? (\n            <div ref={dropdownFooterRef} className={styles['dropdown-footer']}>\n              <DropdownFooter content={dropdownStatus.content} hasItems={filteredItems.length >= 1} />\n            </div>\n          ) : null\n        }\n        expandToViewport={expandToViewport}\n        hasContent={filteredItems.length >= 1 || dropdownStatus.content !== null}\n        trapFocus={!!showRecoveryLink}\n      >\n        {open && (\n          <AutosuggestOptionsList\n            options={filteredItems}\n            highlightedOption={highlightedOption}\n            selectOption={selectOption}\n            highlightedIndex={highlightedIndex}\n            setHighlightedIndex={setHighlightedIndex}\n            highlightedOptionId={highlightedOptionId}\n            highlightText={filterText}\n            listId={listId}\n            controlId={controlId}\n            enteredTextLabel={enteredTextLabel}\n            handleLoadMore={handleLoadMore}\n            hasDropdownStatus={dropdownStatus.content !== null}\n            virtualScroll={virtualScroll}\n            selectedAriaLabel={selectedAriaLabel}\n            renderHighlightedAriaLive={renderHighlightedAriaLive}\n            listBottom={!dropdownStatus.isSticky ? <DropdownFooter content={dropdownStatus.content} /> : null}\n            usingMouse={usingMouse}\n          />\n        )}\n      </Dropdown>\n    </div>\n  );\n});\n\nexport default InternalAutosuggest;\n"]},"metadata":{},"sourceType":"module"}
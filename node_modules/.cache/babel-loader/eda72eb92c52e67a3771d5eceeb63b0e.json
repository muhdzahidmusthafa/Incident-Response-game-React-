{"ast":null,"code":"import { __assign, __rest } from \"tslib\"; // Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport clsx from 'clsx';\nimport { useMergeRefs } from '../../hooks/use-merge-refs';\nimport React, { useEffect, useRef } from 'react';\nimport { getBaseProps } from '../../base-component';\nimport { fireNonCancelableEvent, fireKeyboardEvent, getBlurEventRelatedTarget } from '../../events';\nimport { findUpUntil } from '../../utils/dom';\nimport styles from './styles.css.js';\nvar BOTTOM_TRIGGER_OFFSET = 80;\n\nvar getItemIndex = function (containerRef, event) {\n  var target = findUpUntil(event.target, function (element) {\n    return element === containerRef.current || !!element.dataset.mouseTarget;\n  });\n  var mouseTarget = target === null || target === void 0 ? void 0 : target.dataset.mouseTarget;\n  return mouseTarget ? parseInt(mouseTarget) : -1;\n};\n\nvar OptionsList = function (_a, ref) {\n  var _b;\n\n  var open = _a.open,\n      children = _a.children,\n      _c = _a.nativeAttributes,\n      nativeAttributes = _c === void 0 ? {} : _c,\n      onKeyDown = _a.onKeyDown,\n      onBlur = _a.onBlur,\n      onFocus = _a.onFocus,\n      onLoadMore = _a.onLoadMore,\n      onMouseUp = _a.onMouseUp,\n      onMouseMove = _a.onMouseMove,\n      _d = _a.position,\n      position = _d === void 0 ? 'relative' : _d,\n      _e = _a.role,\n      role = _e === void 0 ? 'listbox' : _e,\n      _f = _a.decreaseTopMargin,\n      decreaseTopMargin = _f === void 0 ? false : _f,\n      ariaLabelledby = _a.ariaLabelledby,\n      restProps = __rest(_a, [\"open\", \"children\", \"nativeAttributes\", \"onKeyDown\", \"onBlur\", \"onFocus\", \"onLoadMore\", \"onMouseUp\", \"onMouseMove\", \"position\", \"role\", \"decreaseTopMargin\", \"ariaLabelledby\"]);\n\n  var baseProps = getBaseProps(restProps);\n  var menuRef = useRef(null);\n\n  var handleScroll = function () {\n    var scrollContainer = menuRef === null || menuRef === void 0 ? void 0 : menuRef.current;\n\n    if (scrollContainer) {\n      var bottomEdgePosition = scrollContainer.scrollTop + scrollContainer.clientHeight;\n      var remainingScrollHeight = scrollContainer.scrollHeight - bottomEdgePosition;\n\n      if (remainingScrollHeight < BOTTOM_TRIGGER_OFFSET) {\n        fireNonCancelableEvent(onLoadMore);\n      }\n    }\n  };\n\n  useEffect(function () {\n    if (!open) {\n      return;\n    }\n\n    handleScroll();\n  });\n  var className = clsx(styles['options-list'], (_b = {}, _b[styles['decrease-top-margin']] = decreaseTopMargin, _b));\n  var mergedRef = useMergeRefs(ref, menuRef);\n  return React.createElement(\"ul\", __assign({}, baseProps, nativeAttributes, {\n    className: className,\n    ref: mergedRef,\n    style: {\n      position: position\n    },\n    role: role,\n    onScroll: handleScroll,\n    onKeyDown: function (event) {\n      return onKeyDown && fireKeyboardEvent(onKeyDown, event);\n    },\n    onMouseMove: function (event) {\n      return onMouseMove === null || onMouseMove === void 0 ? void 0 : onMouseMove(getItemIndex(menuRef, event));\n    },\n    onMouseUp: function (event) {\n      return onMouseUp === null || onMouseUp === void 0 ? void 0 : onMouseUp(getItemIndex(menuRef, event));\n    },\n    onBlur: function (event) {\n      return fireNonCancelableEvent(onBlur, {\n        relatedTarget: getBlurEventRelatedTarget(event.nativeEvent)\n      });\n    },\n    onFocus: function () {\n      return fireNonCancelableEvent(onFocus);\n    },\n    tabIndex: -1,\n    \"aria-labelledby\": ariaLabelledby\n  }), open && children);\n};\n\nexport default React.forwardRef(OptionsList);","map":{"version":3,"mappings":"0CAAA;AACA;;AACA,OAAOA,IAAP,MAAiB,MAAjB;AACA,SAASC,YAAT,QAA6B,4BAA7B;AACA,OAAOC,KAAP,IAAgBC,SAAhB,EAA2BC,MAA3B,QAAyC,OAAzC;AACA,SAA6BC,YAA7B,QAAiD,sBAAjD;AACA,SACEC,sBADF,EAKEC,iBALF,EAMEC,yBANF,QAOO,cAPP;AAQA,SAASC,WAAT,QAA4B,iBAA5B;AACA,OAAOC,MAAP,MAAmB,iBAAnB;AAwBA,IAAMC,qBAAqB,GAAG,EAA9B;;AAEA,IAAMC,YAAY,GAAG,UAACC,YAAD,EAA6CC,KAA7C,EAAoE;EACvF,IAAMC,MAAM,GAAGN,WAAW,CACxBK,KAAK,CAACC,MADkB,EAExB,mBAAO;IAAI,cAAO,KAAKF,YAAY,CAACG,OAAzB,IAAoC,CAAC,CAACC,OAAO,CAACC,OAAR,CAAgBC,WAAtD;EAAiE,CAFpD,CAA1B;EAIA,IAAMA,WAAW,GAAGJ,MAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAEG,OAAR,CAAgBC,WAApC;EACA,OAAOA,WAAW,GAAGC,QAAQ,CAACD,WAAD,CAAX,GAA2B,CAAC,CAA9C;AACD,CAPD;;AASA,IAAME,WAAW,GAAG,UAClBC,EADkB,EAiBlBC,GAjBkB,EAiBc;;;EAf9B,QAAI,UAAJ;EAAA,IACAC,QAAQ,cADR;EAAA,IAEAC,wBAFA;EAAA,IAEAC,gBAAgB,mBAAG,EAAH,GAAKD,EAFrB;EAAA,IAGAE,SAAS,eAHT;EAAA,IAIAC,MAAM,YAJN;EAAA,IAKAC,OAAO,aALP;EAAA,IAMAC,UAAU,gBANV;EAAA,IAOAC,SAAS,eAPT;EAAA,IAQAC,WAAW,iBARX;EAAA,IASAC,gBATA;EAAA,IASAC,QAAQ,mBAAG,UAAH,GAAaD,EATrB;EAAA,IAUAE,YAVA;EAAA,IAUAC,IAAI,mBAAG,SAAH,GAAYD,EAVhB;EAAA,IAWAE,yBAXA;EAAA,IAWAC,iBAAiB,mBAAG,KAAH,GAAQD,EAXzB;EAAA,IAYAE,cAAc,oBAZd;EAAA,IAaGC,SAAS,cAdd,+KAcc,CAbZ;;EAiBF,IAAMC,SAAS,GAAGpC,YAAY,CAACmC,SAAD,CAA9B;EACA,IAAME,OAAO,GAAGtC,MAAM,CAAmB,IAAnB,CAAtB;;EAEA,IAAMuC,YAAY,GAAG;IACnB,IAAMC,eAAe,GAAGF,OAAO,SAAP,WAAO,WAAP,GAAO,MAAP,UAAO,CAAE1B,OAAjC;;IACA,IAAI4B,eAAJ,EAAqB;MACnB,IAAMC,kBAAkB,GAAGD,eAAe,CAACE,SAAhB,GAA4BF,eAAe,CAACG,YAAvE;MACA,IAAMC,qBAAqB,GAAGJ,eAAe,CAACK,YAAhB,GAA+BJ,kBAA7D;;MACA,IAAIG,qBAAqB,GAAGrC,qBAA5B,EAAmD;QACjDL,sBAAsB,CAACwB,UAAD,CAAtB;MACD;IACF;EACF,CATD;;EAWA3B,SAAS,CAAC;IACR,IAAI,CAAC+C,IAAL,EAAW;MACT;IACD;;IACDP,YAAY;EACb,CALQ,CAAT;EAOA,IAAMQ,SAAS,GAAGnD,IAAI,CAACU,MAAM,CAAC,cAAD,CAAP,GAAuB0C,SAC3CA,GAAC1C,MAAM,CAAC,qBAAD,CAAP,IAAiC4B,iBADU,IAAvB,EAAtB;EAIA,IAAMe,SAAS,GAAGpD,YAAY,CAACsB,GAAD,EAAMmB,OAAN,CAA9B;EAEA,OACExC,uCACMuC,SADN,EAEMf,gBAFN,EAEsB;IACpByB,SAAS,EAAEA,SADS;IAEpB5B,GAAG,EAAE8B,SAFe;IAGpBC,KAAK,EAAE;MAAEpB,QAAQ;IAAV,CAHa;IAIpBE,IAAI,EAAEA,IAJc;IAKpBmB,QAAQ,EAAEZ,YALU;IAMpBhB,SAAS,EAAE,iBAAK;MAAI,gBAAS,IAAIpB,iBAAiB,CAACoB,SAAD,EAAYb,KAAZ,CAA9B;IAAgD,CANhD;IAOpBkB,WAAW,EAAE,iBAAK;MAAI,kBAAW,SAAX,eAAW,WAAX,GAAW,MAAX,cAAW,CAAGpB,YAAY,CAAC8B,OAAD,EAAU5B,KAAV,CAAf,CAAX;IAA2C,CAP7C;IAQpBiB,SAAS,EAAE,iBAAK;MAAI,gBAAS,SAAT,aAAS,WAAT,GAAS,MAAT,YAAS,CAAGnB,YAAY,CAAC8B,OAAD,EAAU5B,KAAV,CAAf,CAAT;IAAyC,CARzC;IASpBc,MAAM,EAAE,iBAAK;MAAI,6BAAsB,CAACA,MAAD,EAAS;QAAE4B,aAAa,EAAEhD,yBAAyB,CAACM,KAAK,CAAC2C,WAAP;MAA1C,CAAT,CAAtB;IAA+F,CAT5F;IAUpB5B,OAAO,EAAE;MAAM,6BAAsB,CAACA,OAAD,CAAtB;IAA+B,CAV1B;IAWpB6B,QAAQ,EAAE,CAAC,CAXS;IAWR,mBACKnB;EAZG,CAFtB,GAgBGW,IAAI,IAAI1B,QAhBX,CADF;AAoBD,CAlED;;AAoEA,eAAetB,KAAK,CAACyD,UAAN,CAAiBtC,WAAjB,CAAf","names":["clsx","useMergeRefs","React","useEffect","useRef","getBaseProps","fireNonCancelableEvent","fireKeyboardEvent","getBlurEventRelatedTarget","findUpUntil","styles","BOTTOM_TRIGGER_OFFSET","getItemIndex","containerRef","event","target","current","element","dataset","mouseTarget","parseInt","OptionsList","_a","ref","children","_c","nativeAttributes","onKeyDown","onBlur","onFocus","onLoadMore","onMouseUp","onMouseMove","_d","position","_e","role","_f","decreaseTopMargin","ariaLabelledby","restProps","baseProps","menuRef","handleScroll","scrollContainer","bottomEdgePosition","scrollTop","clientHeight","remainingScrollHeight","scrollHeight","open","className","_b","mergedRef","style","onScroll","relatedTarget","nativeEvent","tabIndex","forwardRef"],"sourceRoot":"","sources":["../../../../../src/internal/components/options-list/index.tsx"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport clsx from 'clsx';\nimport { useMergeRefs } from '../../hooks/use-merge-refs';\nimport React, { useEffect, useRef } from 'react';\nimport { BaseComponentProps, getBaseProps } from '../../base-component';\nimport {\n  fireNonCancelableEvent,\n  NonCancelableEventHandler,\n  CancelableEventHandler,\n  BaseKeyDetail,\n  fireKeyboardEvent,\n  getBlurEventRelatedTarget,\n} from '../../events';\nimport { findUpUntil } from '../../utils/dom';\nimport styles from './styles.css.js';\n\nexport interface OptionsListProps extends BaseComponentProps {\n  open?: boolean;\n  /**\n   * Options list\n   */\n  children: React.ReactNode;\n  nativeAttributes?: Record<string, any>;\n  /**\n   * Called when more items need to be loaded.\n   */\n  onLoadMore?: NonCancelableEventHandler;\n  onKeyDown?: CancelableEventHandler<BaseKeyDetail>;\n  onBlur?: NonCancelableEventHandler<{ relatedTarget: Node | null }>;\n  onFocus?: NonCancelableEventHandler;\n  onMouseUp?: (itemIndex: number) => void;\n  onMouseMove?: (itemIndex: number) => void;\n  position?: React.CSSProperties['position'];\n  role?: 'listbox' | 'list' | 'menu';\n  ariaLabelledby?: string;\n  decreaseTopMargin?: boolean;\n}\n\nconst BOTTOM_TRIGGER_OFFSET = 80;\n\nconst getItemIndex = (containerRef: React.RefObject<HTMLElement>, event: React.MouseEvent) => {\n  const target = findUpUntil(\n    event.target as HTMLElement,\n    element => element === containerRef.current || !!element.dataset.mouseTarget\n  );\n  const mouseTarget = target?.dataset.mouseTarget;\n  return mouseTarget ? parseInt(mouseTarget) : -1;\n};\n\nconst OptionsList = (\n  {\n    open,\n    children,\n    nativeAttributes = {},\n    onKeyDown,\n    onBlur,\n    onFocus,\n    onLoadMore,\n    onMouseUp,\n    onMouseMove,\n    position = 'relative',\n    role = 'listbox',\n    decreaseTopMargin = false,\n    ariaLabelledby,\n    ...restProps\n  }: OptionsListProps,\n  ref: React.Ref<HTMLUListElement>\n) => {\n  const baseProps = getBaseProps(restProps);\n  const menuRef = useRef<HTMLUListElement>(null);\n\n  const handleScroll = () => {\n    const scrollContainer = menuRef?.current;\n    if (scrollContainer) {\n      const bottomEdgePosition = scrollContainer.scrollTop + scrollContainer.clientHeight;\n      const remainingScrollHeight = scrollContainer.scrollHeight - bottomEdgePosition;\n      if (remainingScrollHeight < BOTTOM_TRIGGER_OFFSET) {\n        fireNonCancelableEvent(onLoadMore);\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (!open) {\n      return;\n    }\n    handleScroll();\n  });\n\n  const className = clsx(styles['options-list'], {\n    [styles['decrease-top-margin']]: decreaseTopMargin,\n  });\n\n  const mergedRef = useMergeRefs(ref, menuRef);\n\n  return (\n    <ul\n      {...baseProps}\n      {...nativeAttributes}\n      className={className}\n      ref={mergedRef}\n      style={{ position }}\n      role={role}\n      onScroll={handleScroll}\n      onKeyDown={event => onKeyDown && fireKeyboardEvent(onKeyDown, event)}\n      onMouseMove={event => onMouseMove?.(getItemIndex(menuRef, event))}\n      onMouseUp={event => onMouseUp?.(getItemIndex(menuRef, event))}\n      onBlur={event => fireNonCancelableEvent(onBlur, { relatedTarget: getBlurEventRelatedTarget(event.nativeEvent) })}\n      onFocus={() => fireNonCancelableEvent(onFocus)}\n      tabIndex={-1}\n      aria-labelledby={ariaLabelledby}\n    >\n      {open && children}\n    </ul>\n  );\n};\n\nexport default React.forwardRef(OptionsList);\n"]},"metadata":{},"sourceType":"module"}